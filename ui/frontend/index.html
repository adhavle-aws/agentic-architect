<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Architect - A2A Agents</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --aws-squid-ink: #232f3e;
            --aws-orange: #ff9900;
            --aws-blue: #0073bb;
            --aws-green: #037f0c;
            --aws-red: #d13212;
            --border: #d5dbdb;
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --text-primary: #16191f;
            --text-secondary: #545b64;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Amazon Ember', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .container { display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--aws-squid-ink);
            color: white;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .sidebar-header p {
            font-size: 0.75rem;
            opacity: 0.6;
        }
        
        .menu-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            border-left: 3px solid transparent;
            color: rgba(255,255,255,0.8);
        }
        
        .menu-item:hover { background: rgba(255,255,255,0.05); }
        .menu-item.active {
            background: rgba(255,153,0,0.1);
            border-left-color: var(--aws-orange);
            color: white;
        }
        
        .menu-item-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .menu-item-desc {
            font-size: 0.75rem;
            opacity: 0.7;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: var(--aws-squid-ink);
            color: white;
            padding: 1rem 2rem;
            border-bottom: 4px solid var(--aws-orange);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .agent-badge {
            padding: 0.4rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        /* Chat Layout */
        .chat-layout {
            display: flex;
            flex: 1;
            gap: 1rem;
            padding: 1rem;
        }
        
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
        }
        
        .chat-status { color: var(--aws-green); font-weight: 600; }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            display: flex;
            gap: 0.75rem;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-user { flex-direction: row-reverse; }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .avatar-user { background: var(--aws-blue); }
        .avatar-agent { background: var(--aws-orange); }
        
        .message-content {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            max-width: 75%;
            line-height: 1.5;
        }
        
        .message-user .message-content {
            background: var(--aws-blue);
            color: white;
        }
        
        .message-agent .message-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }
        
        .chat-input {
            padding: 1rem;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
            display: flex;
            gap: 1rem;
        }
        
        .chat-input textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: none;
            min-height: 60px;
        }
        
        .chat-input textarea:focus {
            outline: none;
            border-color: var(--aws-blue);
            box-shadow: 0 0 0 1px var(--aws-blue);
        }
        
        .btn {
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--aws-orange);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) { background: #ec7211; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Results Panel */
        .results-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        .results-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            font-weight: 600;
        }
        
        .results-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .markdown-content { line-height: 1.6; }
        .markdown-content h2 { margin: 1.5rem 0 0.75rem; }
        .markdown-content p { margin-bottom: 1rem; }
        .markdown-content code {
            background: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: Monaco, monospace;
            font-size: 0.9em;
        }
        .markdown-content pre {
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .markdown-content pre code { background: none; padding: 0; }
        
        .welcome {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }
        
        .typing span {
            animation: typing 1.4s infinite;
            opacity: 0;
        }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0; }
            30% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Agentic Architect</h2>
                <p>A2A Conversational Agents</p>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" id="onboardingMenu" onclick="switchAgent('onboarding')">
                    <div class="menu-item-title">ðŸ¤– Onboarding Agent</div>
                    <div class="menu-item-desc">Design & architecture</div>
                </div>
                <div class="menu-item" id="provisioningMenu" onclick="switchAgent('provisioning')">
                    <div class="menu-item-title">ðŸš€ Provisioning Agent</div>
                    <div class="menu-item-desc">Deploy & monitor</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1>AWS Architect AI</h1>
                <div class="agent-badge" id="agentBadge">Onboarding Agent</div>
            </div>
            
            <div class="chat-layout">
                <div class="chat-panel">
                    <div class="chat-header">
                        <span>Conversation</span>
                        <span class="chat-status" id="status">ðŸŸ¢ Connected</span>
                    </div>
                    <div class="chat-messages" id="messages">
                        <div class="welcome">
                            <h2>ðŸ‘‹ Welcome!</h2>
                            <p>I'm your AWS Solutions Architect.</p>
                            <p>Ask me anything about cloud architecture.</p>
                        </div>
                    </div>
                    <div class="chat-input">
                        <textarea id="input" placeholder="Ask about AWS architecture..." 
                            onkeypress="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send();}"></textarea>
                        <button class="btn btn-primary" onclick="send()" id="sendBtn">Send</button>
                    </div>
                </div>
                
                <div class="results-panel">
                    <div class="results-header">Generated Content</div>
                    <div class="results-content" id="results">
                        <div class="welcome">Content will appear here</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const WS_URL = 'wss://3vq3ao8ng1.execute-api.us-east-1.amazonaws.com/prod';
        let ws = null;
        let currentAgent = 'onboarding';
        let sessionId = `session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;
        let callbacks = new Map();
        
        function initWS() {
            ws = new WebSocket(WS_URL);
            
            ws.onopen = () => {
                console.log('âœ… Connected');
                document.getElementById('status').textContent = 'ðŸŸ¢ Connected';
            };
            
            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                console.log('ðŸ“¨', msg);
                
                if (msg.type === 'response') {
                    const cb = callbacks.get(msg.requestId);
                    if (cb) {
                        cb(msg.response);
                        callbacks.delete(msg.requestId);
                    }
                    addMessage('agent', msg.response);
                    document.getElementById('sendBtn').disabled = false;
                } else if (msg.type === 'error') {
                    addMessage('error', msg.error);
                    document.getElementById('sendBtn').disabled = false;
                }
            };
            
            ws.onerror = () => {
                document.getElementById('status').textContent = 'ðŸ”´ Error';
            };
            
            ws.onclose = () => {
                document.getElementById('status').textContent = 'ðŸŸ¡ Reconnecting...';
                setTimeout(initWS, 2000);
            };
        }
        
        function switchAgent(agent) {
            currentAgent = agent;
            sessionId = `session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;
            
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(agent === 'onboarding' ? 'onboardingMenu' : 'provisioningMenu').classList.add('active');
            document.getElementById('agentBadge').textContent = agent === 'onboarding' ? 'Onboarding Agent' : 'Provisioning Agent';
            
            clearChat();
        }
        
        function send() {
            const input = document.getElementById('input');
            const message = input.value.trim();
            if (!message || !ws || ws.readyState !== WebSocket.OPEN) return;
            
            addMessage('user', message);
            input.value = '';
            document.getElementById('sendBtn').disabled = true;
            
            const requestId = Date.now().toString();
            
            ws.send(JSON.stringify({
                id: requestId,
                agentType: currentAgent,
                message: message,
                sessionId: sessionId
            }));
            
            showTyping();
        }
        
        function addMessage(role, content) {
            const container = document.getElementById('messages');
            const welcome = container.querySelector('.welcome');
            if (welcome) welcome.remove();
            
            removeTyping();
            
            const div = document.createElement('div');
            div.className = `message message-${role}`;
            
            if (role === 'user') {
                div.innerHTML = `
                    <div class="avatar avatar-user">ðŸ‘¤</div>
                    <div class="message-content">${escapeHtml(content)}</div>
                `;
            } else if (role === 'agent') {
                div.innerHTML = `
                    <div class="avatar avatar-agent">ðŸ¤–</div>
                    <div class="message-content markdown-content">${marked.parse(content)}</div>
                `;
                updateResults(content);
            } else {
                div.innerHTML = `<div class="message-content" style="background:#fef6f6;color:var(--aws-red);">${escapeHtml(content)}</div>`;
            }
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        function showTyping() {
            const container = document.getElementById('messages');
            const div = document.createElement('div');
            div.id = 'typing';
            div.className = 'message message-agent';
            div.innerHTML = `
                <div class="avatar avatar-agent">ðŸ¤–</div>
                <div class="message-content typing"><span>.</span><span>.</span><span>.</span></div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        function removeTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }
        
        function clearChat() {
            document.getElementById('messages').innerHTML = `
                <div class="welcome">
                    <h2>ðŸ‘‹ Welcome!</h2>
                    <p>I'm your ${currentAgent === 'onboarding' ? 'architecture design' : 'deployment'} assistant.</p>
                    <p>How can I help you today?</p>
                </div>
            `;
            document.getElementById('results').innerHTML = '<div class="welcome">Content will appear here</div>';
        }
        
        function updateResults(content) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="markdown-content">${marked.parse(content)}</div>`;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Initialize
        initWS();
    </script>
</body>
</html>
